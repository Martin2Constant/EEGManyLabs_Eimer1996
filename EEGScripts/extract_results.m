function extract_results(filepath, team)
    % Author: Martin Constant (martin.constant@uni-bremen.de)
    files = dir(fullfile([team filesep 'ERP'], [team '_participant*.erp']));
    mean_rts = table('Size',[length(files), 2], ...
        'VariableTypes', {'double', 'double'}, ...
        'VariableNames', {'RT_letters', 'RT_colors'});
    for sub = 1:length(files)
        erp_name = files(sub).name;
        ERP = pop_loaderp( 'filename', erp_name, 'filepath', files(sub).folder);
        mean_rts = get_rts(ERP, mean_rts, sub);
        ALLERP(sub) = ERP;
    end
    
    % Extract amplitude values for each condition
    [ALLERP, letters_amp] = pop_geterpvalues( ALLERP, [220 300],  [13 14], [ERP.PO7_8_index], 'Baseline', 'pre', 'Erpsets', 1:length(ALLERP), 'FileFormat', 'wide', 'Filename',...
        [filepath filesep team filesep 'Results' filesep 'mean_amp_letters_N2pc.txt'], 'Fracreplace', 'NaN', 'InterpFactor',  1, 'Measure', 'meanbl', 'PeakOnset',  1, 'Resolution',  9 );
    [ALLERP, colors_amp] = pop_geterpvalues( ALLERP, [220 300],  [16 17], [ERP.PO7_8_index], 'Baseline', 'pre', 'Erpsets', 1:length(ALLERP), 'FileFormat', 'wide', 'Filename',...
            [filepath filesep team filesep 'Results' filesep 'mean_amp_colors_N2pc.txt'], 'Fracreplace', 'NaN', 'InterpFactor',  1, 'Measure', 'meanbl', 'PeakOnset',  1, 'Resolution',  9 );
    letters_contra_amp = letters_amp(1,:)';
    letters_ipsi_amp = letters_amp(2,:)';
    colors_contra_amp = colors_amp(1,:)';
    colors_ipsi_amp = colors_amp(2,:)';

    % Run paired-sample t-test on amplitude values and RTs
    [mean_amps_letters, between_ci_amp_letters, within_ci_amp_letters, stats_amp_letters] = custom_paired_t_test(letters_contra_amp, letters_ipsi_amp, 0.02, "less");
    [mean_amps_colors, between_ci_amp_colors, within_ci_amp_colors, stats_amp_colors] = custom_paired_t_test(colors_contra_amp, colors_ipsi_amp, 0.02, "less");
    [mean_rt, between_ci_rt, within_ci_rt, stats_rt] = custom_paired_t_test(mean_rts.RT_letters, mean_rts.RT_colors);
    save('results_letters.mat', 'mean_amps_letters', 'between_ci_amp_letters', 'within_ci_amp_letters', 'stats_amp_letters');
    save('results_colors.mat', 'mean_amps_colors', 'between_ci_amp_colors', 'within_ci_amp_colors', 'stats_amp_colors');
    save('results_rt.mat', 'mean_rt', 'between_ci_rt', 'within_ci_rt', 'stats_rt');
    amplitudes_table = table(letters_ipsi_amp, letters_contra_amp, ...
        colors_ipsi_amp, colors_contra_amp, ...
        'VariableNames', {'Letters_ipsi', 'Letters_contra', 'Colors_ipsi', 'Colors_contra'});
    writetable(amplitudes_table, sprintf('%s%s%s%sResults%samplitudes_table.csv', filepath, filesep, team, filesep, filesep));
    
    % Write results of t-tests to console and files.
    letters_output = sprintf("For the team %s, letters distractor arrays between 220 ms and 300 ms with correct responses:\n" + ...
        "The mean contralateral amplitude is %.2f µV ± %.2f.\n" + ...
        "The mean ipsilateral amplitude is %.2f µV ± %.2f.\n" + ...
        "Thus, the mean contra-ipsi difference is %.2f µV ± %.2f.\n" + ...
        "One-tailed paired-sample t-test with N = %i, alpha = %.2e" + ...
        " and hypothesis: contralateral µV < ipsilateral µV.\n" + ...
        "t(%i) = %.2f, p = %.2e, dz = %.2f [%.2f, %.2f], gz = %.2f [%.2f, %.2f].\n" + ...
        "The null hypothesis is therefore %s.", ...
        team, mean_amps_letters(1), within_ci_amp_letters(1), ...
        mean_amps_letters(2), within_ci_amp_letters(2),...
        stats_amp_letters.mean_diff, stats_amp_letters.diff_ci,...
        stats_amp_letters.n, stats_amp_letters.alpha,...
        stats_amp_letters.df, stats_amp_letters.t, stats_amp_letters.p,...
        stats_amp_letters.dz(1), stats_amp_letters.dz(2), stats_amp_letters.dz(3),...
        stats_amp_letters.gz(1), stats_amp_letters.gz(2), stats_amp_letters.gz(3),...
        stats_amp_letters.reject_null)
    
    letters_fileID = fopen(sprintf('%s%s%s%sResults%sletters_output.txt', filepath, filesep, team, filesep, filesep), 'w');
    fprintf(letters_fileID, letters_output);
    fclose(letters_fileID);

    colors_output = sprintf("For the team %s, colors distractor arrays between 220 ms and 300 ms with correct responses:\n" + ...
        "The mean contralateral amplitude is %.2f µV ± %.2f.\n" + ...
        "The mean ipsilateral amplitude is %.2f µV ± %.2f.\n" + ...
        "Thus, the mean contra-ipsi difference is %.2f µV ± %.2f.\n" + ...
        "One-tailed paired-sample t-test with N = %i, alpha = %.2e" + ...
        " and hypothesis: contralateral µV < ipsilateral µV.\n" + ...
        "t(%i) = %.2f, p = %.2e, dz = %.2f [%.2f, %.2f], gz = %.2f [%.2f, %.2f].\n" + ...
        "The null hypothesis is therefore %s.", ...
        team, mean_amps_colors(1), between_ci_amp_colors(1), ...
        mean_amps_colors(2), between_ci_amp_colors(2),...
        stats_amp_colors.mean_diff, stats_amp_colors.diff_ci,...
        stats_amp_colors.n, stats_amp_colors.alpha,...
        stats_amp_colors.df, stats_amp_colors.t, stats_amp_colors.p,...
        stats_amp_colors.dz(1), stats_amp_colors.dz(2), stats_amp_colors.dz(3),...
        stats_amp_colors.gz(1), stats_amp_colors.gz(2), stats_amp_colors.gz(3),...
        stats_amp_colors.reject_null)
    
    colors_fileID = fopen(sprintf('%s%s%s%sResults%scolors_output.txt', filepath, filesep, team, filesep, filesep), 'w');
    fprintf(colors_fileID, colors_output);
    fclose(colors_fileID);
end
