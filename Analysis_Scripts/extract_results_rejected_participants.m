function extract_results_rejected_participants(filepath, pipeline)
    % Author: Martin Constant (martin.constant@unige.ch)
    arguments
        filepath char;
        pipeline char;
    end
    files = dir(fullfile([filepath filesep 'Bad_erp' filesep 'Excluded_ERPs' filesep pipeline], ['excluded_*_participant*_' pipeline '_*']));
    for id = 1:length(files)
        erp_name = files(id).name;
        ERP = pop_loaderp( 'filename', erp_name, 'filepath', files(id).folder);
        ERP = pop_erpchanoperator(ERP, {sprintf('nch1 = ch%i label PO7/8', ERP.PO7_8_index)}, 'ErrorMsg', 'popup', 'KeepLocations',  0, 'Warning', 'on' );
        ALLERP(id) = ERP; %#ok<AGROW>
    end
    results_path = sprintf('%s%sBad_erp%s', filepath, filesep, filesep);

    onset = 220;
    offset = 300;
    
    % Extract amplitude values for each condition
    [ALLERP, forms_amp] = pop_geterpvalues( ALLERP, [onset offset],  [13 14], [1], 'Baseline', 'pre', 'Erpsets', 1:length(ALLERP), 'FileFormat', 'wide', 'Filename',...
        [results_path 'bad_mean_amp_forms_N2pc.txt'], 'Fracreplace', 'NaN', 'InterpFactor',  1, 'Measure', 'meanbl', 'PeakOnset',  1, 'Resolution',  9 );
    [ALLERP, colors_amp] = pop_geterpvalues( ALLERP, [onset offset],  [16 17], [1], 'Baseline', 'pre', 'Erpsets', 1:length(ALLERP), 'FileFormat', 'wide', 'Filename',...
        [results_path 'bad_mean_amp_colors_N2pc.txt'], 'Fracreplace', 'NaN', 'InterpFactor',  1, 'Measure', 'meanbl', 'PeakOnset',  1, 'Resolution',  9 );

    forms_contra_amp = forms_amp(1,:)';
    forms_ipsi_amp = forms_amp(2,:)';
    colors_contra_amp = colors_amp(1,:)';
    colors_ipsi_amp = colors_amp(2,:)';

    % Run paired-sample t-test on amplitude values
    [mean_amps_forms, between_ci_amp_forms, within_ci_amp_forms, stats_amp_forms] = custom_paired_t_test(forms_contra_amp, forms_ipsi_amp, 0.02, "less");
    [mean_amps_colors, between_ci_amp_colors, within_ci_amp_colors, stats_amp_colors] = custom_paired_t_test(colors_contra_amp, colors_ipsi_amp, 0.02, "less");
    [mean_amps_interaction, between_ci_amp_interaction, within_ci_amp_interaction, stats_amp_interaction] = custom_paired_t_test(forms_contra_amp-forms_ipsi_amp, colors_contra_amp-colors_ipsi_amp, 0.02, "less");

    mean_amplitudes_table = table(forms_contra_amp, forms_ipsi_amp, ...
        colors_contra_amp, colors_ipsi_amp, ...
        forms_contra_amp - forms_ipsi_amp, colors_contra_amp - colors_ipsi_amp, ...
        'VariableNames', {'Forms_contra', 'Forms_ipsi', 'Colors_contra', 'Colors_ipsi', 'Forms_Contra-Ipsi', 'Colors_Contra-Ipsi'});
    writetable(mean_amplitudes_table, sprintf('%sbad_amplitudes_table.csv', results_path));

    % Export GA time series data
    GA = pop_gaverager( ALLERP , 'DQ_flag', 0, 'Erpsets', 1:length(ALLERP), 'ExcludeNullBin', 'on', 'SEM', 'off' );
    time_series_table = table(GA.bindata(1, :, 13)', GA.bindata(1, :, 14)',...
        GA.bindata(1, :, 16)', GA.bindata(1, :, 17)',...
        GA.bindata(1, :, 15)', GA.bindata(1, :, 18)',...
        'VariableNames', {'Forms_contra', 'Forms_ipsi', 'Colors_contra', 'Colors_ipsi', 'Forms_Contra-Ipsi', 'Colors_Contra-Ipsi'});
    writetable(time_series_table, sprintf('%sbad_time_series_table.csv', results_path));

    % Write results of t-tests to console and files.
    forms_output = sprintf("For the bad ERPs with the %s pipeline, forms distractor arrays between %i ms and %i ms with correct responses:\n" + ...
        "The mean contralateral amplitude is %.2f µV ± %.2f.\n" + ...
        "The mean ipsilateral amplitude is %.2f µV ± %.2f.\n" + ...
        "Thus, the mean contra-ipsi difference is %.2f µV ± %.2f.\n" + ...
        "One-tailed paired-sample t-test with N = %i, alpha = %.2e" + ...
        " and hypothesis: contralateral µV < ipsilateral µV.\n" + ...
        "t(%i) = %.2f, p = %.2e, dz = %.2f [%.2f, %.2f], dz s.e. = %.2f," + ...
        " gz = %.2f [%.2f, %.2f], gz s.e = %.2f.\n" + ...
        "The null hypothesis is therefore %s.\n" + ...
        "Effect sizes to convert to r (for meta-analyses):\n" + ...
        "drm = %.2f [%.2f, %.2f], drm s.e. = %.2f." + ...
        " grm = %.2f [%.2f, %.2f], grm s.e. = %.2f.\n", ...
        pipeline, onset, offset, mean_amps_forms(1), within_ci_amp_forms(1), ...
        mean_amps_forms(2), within_ci_amp_forms(2), ...
        stats_amp_forms.mean_diff, stats_amp_forms.diff_ci, ...
        stats_amp_forms.n, stats_amp_forms.alpha, ...
        stats_amp_forms.df, stats_amp_forms.t, stats_amp_forms.p, ...
        stats_amp_forms.dz.eff, stats_amp_forms.dz.low_ci,...
        stats_amp_forms.dz.high_ci, stats_amp_forms.dz.se, ...
        stats_amp_forms.gz.eff, stats_amp_forms.gz.low_ci,...
        stats_amp_forms.gz.high_ci, stats_amp_forms.gz.se, ...
        stats_amp_forms.reject_null, ...
        stats_amp_forms.drm.eff, stats_amp_forms.drm.low_ci,...
        stats_amp_forms.drm.high_ci, stats_amp_forms.drm.se,...
        stats_amp_forms.grm.eff, stats_amp_forms.grm.low_ci,...
        stats_amp_forms.grm.high_ci, stats_amp_forms.grm.se) %#ok<*NOPRT>

    forms_fileID = fopen(sprintf('%sforms_bad_output.txt', results_path), 'w');
    fprintf(forms_fileID, forms_output);
    fclose(forms_fileID);

    colors_output = sprintf("For the bad ERPs with the %s pipeline, colors distractor arrays between %i ms and %i ms with correct responses:\n" + ...
        "The mean contralateral amplitude is %.2f µV ± %.2f.\n" + ...
        "The mean ipsilateral amplitude is %.2f µV ± %.2f.\n" + ...
        "Thus, the mean contra-ipsi difference is %.2f µV ± %.2f.\n" + ...
        "One-tailed paired-sample t-test with N = %i, alpha = %.2e" + ...
        " and hypothesis: contralateral µV < ipsilateral µV.\n" + ...
        "t(%i) = %.2f, p = %.2e, dz = %.2f [%.2f, %.2f], dz s.e. = %.2f," + ...
        " gz = %.2f [%.2f, %.2f], gz s.e. = %.2f.\n" + ...
        "The null hypothesis is therefore %s.\n" + ...
        "Effect sizes to convert to r (for meta-analyses):\n" + ...
        "drm = %.2f [%.2f, %.2f], drm s.e. = %.2f." + ...
        " grm = %.2f [%.2f, %.2f], grm s.e. = %.2f.\n", ...
        pipeline, onset, offset, mean_amps_colors(1), within_ci_amp_colors(1), ...
        mean_amps_colors(2), within_ci_amp_colors(2),...
        stats_amp_colors.mean_diff, stats_amp_colors.diff_ci,...
        stats_amp_colors.n, stats_amp_colors.alpha,...
        stats_amp_colors.df, stats_amp_colors.t, stats_amp_colors.p,...
        stats_amp_colors.dz.eff, stats_amp_colors.dz.low_ci,...
        stats_amp_colors.dz.high_ci, stats_amp_colors.dz.se,...
        stats_amp_colors.gz.eff, stats_amp_colors.gz.low_ci,...
        stats_amp_colors.gz.high_ci, stats_amp_colors.gz.se,...
        stats_amp_colors.reject_null, ...
        stats_amp_colors.drm.eff, stats_amp_colors.drm.low_ci,...
        stats_amp_colors.drm.high_ci, stats_amp_colors.drm.se,...
        stats_amp_colors.grm.eff, stats_amp_colors.grm.low_ci,...
        stats_amp_colors.grm.high_ci, stats_amp_colors.grm.se)

    colors_fileID = fopen(sprintf('%scolors_bad_output.txt', results_path), 'w');
    fprintf(colors_fileID, colors_output);
    fclose(colors_fileID);

    interaction_output = sprintf("For the bad ERPs with the %s pipeline, contra-ipsi forms vs. colors distractor arrays between %i ms and %i ms with correct responses:\n" + ...
        "The mean contra-ipsi forms amplitude is %.2f µV ± %.2f.\n" + ...
        "The mean contra-ipsi colors amplitude is %.2f µV ± %.2f.\n" + ...
        "Thus, the mean difference between forms and colors is %.2f µV ± %.2f.\n" + ...
        "One-tailed paired-sample t-test with N = %i, alpha = %.2e" + ...
        " and hypothesis: forms µV < colors µV.\n" + ...
        "t(%i) = %.2f, p = %.2e, dz = %.2f [%.2f, %.2f], dz s.e. = %.2f," + ...
        " gz = %.2f [%.2f, %.2f], gz s.e. = %.2f.\n" + ...
        "The null hypothesis is therefore %s.\n" + ...
        "Effect sizes to convert to r (for meta-analyses):\n" + ...
        "drm = %.2f [%.2f, %.2f], drm s.e. = %.2f." + ...
        " grm = %.2f [%.2f, %.2f], grm s.e. = %.2f.\n", ...
        pipeline, onset, offset, mean_amps_interaction(1), within_ci_amp_interaction(1), ...
        mean_amps_interaction(2), within_ci_amp_interaction(2),...
        stats_amp_interaction.mean_diff, stats_amp_interaction.diff_ci,...
        stats_amp_interaction.n, stats_amp_interaction.alpha,...
        stats_amp_interaction.df, stats_amp_interaction.t, stats_amp_interaction.p,...
        stats_amp_interaction.dz.eff, stats_amp_interaction.dz.low_ci,...
        stats_amp_interaction.dz.high_ci, stats_amp_interaction.dz.se,...
        stats_amp_interaction.gz.eff, stats_amp_interaction.gz.low_ci,...
        stats_amp_interaction.gz.high_ci, stats_amp_interaction.gz.se,...
        stats_amp_interaction.reject_null, ...
        stats_amp_interaction.drm.eff, stats_amp_interaction.drm.low_ci,...
        stats_amp_interaction.drm.high_ci, stats_amp_interaction.drm.se,...
        stats_amp_interaction.grm.eff, stats_amp_interaction.grm.low_ci,...
        stats_amp_interaction.grm.high_ci, stats_amp_interaction.grm.se)

    interaction_fileID = fopen(sprintf('%sinteraction_bad_output.txt', results_path), 'w');
    fprintf(interaction_fileID, interaction_output);
    fclose(interaction_fileID);
end
